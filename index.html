<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monitor Kehadiran Siswa</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
    }

    h2 {
      text-align: center;
      margin-bottom: 30px;
      color: #2d3748;
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
      transform: translateY(0);
      transition: transform 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    .stat-card i {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    .stat-number {
      font-size: 1.8rem;
      font-weight: 700;
    }

    .stat-label {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .filter-container {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      margin-bottom: 30px;
      border: 1px solid rgba(102, 126, 234, 0.1);
    }

    .filter-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .filter-row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: center;
    }

    .filter-container input, 
    .filter-container select {
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.3s ease;
      background: white;
      min-width: 200px;
      flex: 1;
    }

    .filter-container input:focus, 
    .filter-container select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      transform: translateY(-2px);
    }

    .filter-container input::placeholder {
      color: #a0aec0;
    }

    .filter-container button {
      padding: 12px 24px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .filter-container button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .table-container {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(102, 126, 234, 0.1);
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 18px 15px;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.85rem;
      letter-spacing: 0.5px;
      border: none;
    }

    td {
      padding: 15px;
      border-bottom: 1px solid #f1f5f9;
      color: #4a5568;
      transition: background-color 0.3s ease;
    }

    tr:hover td {
      background-color: #f8fafc;
    }

    tr:nth-child(even) td {
      background-color: #fafbfc;
    }

    .status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-hadir {
      background: #d4edda;
      color: #155724;
    }

    .status-tidak-hadir {
      background: #f8d7da;
      color: #721c24;
    }

    .status-terlambat {
      background: #fff3cd;
      color: #856404;
    }

    .pagination {
      margin-top: 25px;
      text-align: center;
    }

    .pagination button {
      padding: 10px 16px;
      margin: 0 5px;
      border: 2px solid transparent;
      border-radius: 8px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .pagination button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .pagination button:disabled {
      background: #cbd5e0;
      color: #a0aec0;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .empty-state {
      text-align: center;
      padding: 50px 20px;
      color: #a0aec0;
    }

    .empty-state i {
      font-size: 4rem;
      margin-bottom: 20px;
    }

    .loading {
      text-align: center;
      padding: 50px;
      color: #667eea;
    }

    .loading i {
      font-size: 3rem;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
      .container {
        padding: 20px;
        margin: 10px;
      }

      h2 {
        font-size: 2rem;
      }

      .filter-row {
        flex-direction: column;
      }

      .filter-container input,
      .filter-container select {
        min-width: 100%;
      }

      table {
        font-size: 0.9rem;
      }

      th, td {
        padding: 10px 8px;
      }

      .stats-container {
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2><i class="fas fa-chart-line"></i> Monitor Kehadiran Siswa SDN 2 Karangmangu</h2>
    
    <div class="stats-container">
      <div class="stat-card">
        <i class="fas fa-users"></i>
        <div class="stat-number" id="totalStudents">0</div>
        <div class="stat-label">Total Records</div>
      </div>
      <div class="stat-card">
        <i class="fas fa-check-circle"></i>
        <div class="stat-number" id="presentCount">0</div>
        <div class="stat-label">Hadir</div>
      </div>
      <div class="stat-card">
        <i class="fas fa-times-circle"></i>
        <div class="stat-number" id="absentCount">0</div>
        <div class="stat-label">Tidak Hadir</div>
      </div>
      <div class="stat-card">
        <i class="fas fa-clock"></i>
        <div class="stat-number" id="lateCount">0</div>
        <div class="stat-label">Terlambat</div>
      </div>
    </div>
    
    <div class="filter-container">
      <div class="filter-title">
        <i class="fas fa-filter"></i>
        Filter & Pencarian
      </div>
      <div class="filter-row">
        <input type="text" id="nisFilter" placeholder="ðŸ” Cari Kode Siswa/NIS">
        <input type="text" id="namaFilter" placeholder="ðŸ” Cari Nama Siswa">
        <select id="kelasFilter">
          <option value="">ðŸ“š Semua Kelas</option>
          <option value="Kelas 1">ðŸ“˜ Kelas 1</option>
          <option value="Kelas 2">ðŸ“— Kelas 2</option>
          <option value="Kelas 3">ðŸ“™ Kelas 3</option>
        </select>
        <button onclick="applyFilters()">
          <i class="fas fa-search"></i>
          Filter
        </button>
      </div>
    </div>
    
    <div class="table-container">
      <table id="dataTable">
        <thead>
          <tr>
            <th><i class="fas fa-calendar-alt"></i> Tanggal & Waktu</th>
            <th><i class="fas fa-user"></i> Nama</th>
            <th><i class="fas fa-id-card"></i> Kode Siswa</th>
            <th><i class="fas fa-tag"></i> Tipe</th>
            <th><i class="fas fa-check-square"></i> Status</th>
            <th><i class="fas fa-school"></i> Kelas</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td colspan="6" class="loading">
              <i class="fas fa-spinner"></i>
              <p>Memuat data...</p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class="pagination" id="pagination"></div>
  </div>
  
  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyDDXTywvxWTMtmzIxGSMqU6NRaudMoC5gV_x2RaOWGpmMY4IbdmW2sp_xZF-SN8F-0/exec"; // Ganti dengan URL Web App kamu
    let allData = [];
    let filteredData = [];
    let currentPage = 1;
    const rowsPerPage = 10;

    async function fetchData() {
      const res = await fetch(scriptURL);
      const data = await res.json();
      allData = data.map(d => {
        return {
          Timestamp: formatDate(d.Timestamp),
          Nama: d.Nama,
          "Kode Siswa": d["Kode Siswa"],
          Tipe: d.Tipe,
          Status: d.Status,
          Kelas: d.Kelas
        };
      });
      filteredData = [...allData];
      updateStats();
      displayTable();
    }

    function updateStats() {
      document.getElementById('totalStudents').textContent = allData.length;
      document.getElementById('presentCount').textContent = allData.filter(d => d.Status === 'Hadir').length;
      document.getElementById('absentCount').textContent = allData.filter(d => d.Status === 'Tidak Hadir').length;
      document.getElementById('lateCount').textContent = allData.filter(d => d.Status === 'Terlambat').length;
    }

    function formatDate(dateStr) {
      if (!dateStr) return "";
      const date = new Date(dateStr);
      return date.toLocaleString("id-ID", {
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      });
    }

    function getStatusBadge(status) {
      let className = 'status-badge ';
      switch(status.toLowerCase()) {
        case 'hadir':
          className += 'status-hadir';
          break;
        case 'tidak hadir':
          className += 'status-tidak-hadir';
          break;
        case 'terlambat':
          className += 'status-terlambat';
          break;
        default:
          className += 'status-hadir';
      }
      return `<span class="${className}">${status}</span>`;
    }

    function displayTable() {
      const tableBody = document.querySelector("#dataTable tbody");
      
      if (filteredData.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="6" class="empty-state">
              <i class="fas fa-search"></i>
              <p>Tidak ada data yang ditemukan</p>
              <small>Coba ubah filter pencarian Anda</small>
            </td>
          </tr>
        `;
        document.getElementById("pagination").innerHTML = "";
        return;
      }
      
      const start = (currentPage - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const pageData = filteredData.slice(start, end);

      tableBody.innerHTML = "";
      pageData.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.Timestamp}</td>
          <td><strong>${row.Nama}</strong></td>
          <td>${row["Kode Siswa"]}</td>
          <td>${row.Tipe}</td>
          <td>${getStatusBadge(row.Status)}</td>
          <td>${row.Kelas}</td>
        `;
        tableBody.appendChild(tr);
      });

      setupPagination();
    }

    function setupPagination() {
      const pagination = document.getElementById("pagination");
      pagination.innerHTML = "";
      const totalPages = Math.ceil(filteredData.length / rowsPerPage);

      if (totalPages <= 1) return;

      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.innerText = i;
        btn.disabled = i === currentPage;
        btn.addEventListener("click", () => {
          currentPage = i;
          displayTable();
        });
        pagination.appendChild(btn);
      }
    }

    function applyFilters() {
      const nis = document.getElementById("nisFilter").value.toLowerCase();
      const nama = document.getElementById("namaFilter").value.toLowerCase();
      const kelas = document.getElementById("kelasFilter").value;

      filteredData = allData.filter(d =>
        (!nis || String(d["Kode Siswa"]).toLowerCase().includes(nis)) &&
        (!nama || d.Nama.toLowerCase().includes(nama)) &&
        (!kelas || d.Kelas === kelas)
      );

      currentPage = 1;
      displayTable();
    }

    // Event listeners untuk real-time filtering
    document.getElementById("nisFilter").addEventListener("input", applyFilters);
    document.getElementById("namaFilter").addEventListener("input", applyFilters);
    document.getElementById("kelasFilter").addEventListener("change", applyFilters);

    fetchData();
  </script>
</body>
</html>
